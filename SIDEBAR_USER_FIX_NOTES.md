# Updated Online Users Sidebar - Fix Summary

## What Was Changed

The sidebar user display logic has been completely rewritten to fix the issue where:
- **Old behavior**: Only showed users found in `sideonline.json` (only online users)
- **New behavior**: 
  - Always shows **ALL admins and moderators** regardless of online status
  - Shows other users only when they're online
  - Fetches staff from Discourse admin endpoints

## How It Now Works

### Data Sources (fetched concurrently):
1. **`/sideonline.json`** - Online users (generated by your plugin)
2. **`/admin/users/list/admins.json`** - All administrators
3. **`/admin/users/list/moderators.json`** - All moderators

### Display Logic:

1. **Administrators Section** (always shown)
   - Fetches from admin API
   - Shows green status dot if online (in sideonline.json)
   - Shows gray status dot if offline

2. **Moderators Section** (always shown)
   - Fetches from moderators API
   - Shows green status dot if online (in sideonline.json)
   - Shows gray status dot if offline

3. **Trust Level Sections** (only online users)
   - TL4, TL3, TL2, TL1, TL0
   - Only shown if the user appears in `sideonline.json`
   - All have green status dots (since they're online)

### Status Indicators:
- **Green dot (#43b581)**: User is online
- **Gray dot (#747f8d)**: User is offline (only for staff/moderators)

### Deduplication:
The code uses a Map to ensure no duplicate users:
- Online users are added first
- Admins are added/updated with their online status
- Moderators are added/updated (unless already an admin)

## Console Logging:
The updated code logs helpful debug information:
```
[Discord Chat] Loaded X online users from sideonline.json
[Discord Chat] Loaded X admins and X moderators from admin API
[Discord Chat] Categorized: Admins=X, Mods=X, TL4=X, TL3=X, TL2=X, TL1=X, TL0=X
```

## Key Benefits:
✅ Admins/moderators always visible (easy to contact staff)
✅ Clear online/offline status for staff members
✅ Online users from sideonline.json properly displayed
✅ No duplicate users
✅ Maintains existing Discord-style aesthetics
✅ Better debugging with console logs
