# Online Users Sidebar - Current Implementation

## How It Works

The sidebar now uses a **simple, streamlined approach**:

### Data Source:
- **Only `sideonline.json`** - Generated by your plugin with currently online users

### Display Logic:

All users shown are **online only** and categorized by role/trust level:

1. **Administrators** (if online)
   - Fetched from `sideonline.json`
   - All have green status dots (online)

2. **Moderators** (if online)
   - Fetched from `sideonline.json`
   - All have green status dots (online)

3. **Trust Level Sections** (TL4, TL3, TL2, TL1, TL0)
   - Only shown if users are online
   - All have green status dots (online)

### Key Features:
- ✅ Only shows users who are currently online (from `sideonline.json`)
- ✅ Categorizes by role first (Admin → Moderator), then by Trust Level
- ✅ All status dots are green (everyone shown is online)
- ✅ Clean, simple logic - single data source
- ✅ Automatic refresh based on `user_refresh_interval` setting
- ✅ **Auto-hides when leaving chat** - sidebar automatically removes itself when navigating to forums or other pages

### Page Navigation Behavior:
The sidebar smartly handles page transitions in Discourse (which is a single-page application):

- **On chat pages**: Sidebar is created and updated
- **When navigating away**: Sidebar is automatically removed and refresh timer is cleared
- **Back to chat**: Sidebar is recreated fresh

This ensures the sidebar only appears on chat pages and doesn't persist where it shouldn't.

### Console Logging:
The code logs helpful debug information:
```
[Discord Chat] Loaded X online users from sideonline.json
[Discord Chat] Categorized: Admins=X, Mods=X, TL4=X, TL3=X, TL2=X, TL1=X, TL0=X
```

### Status Indicators:
- **Green dot (#43b581)**: User is online (all users shown)

## What Changed from Previous Version

**Previous**: 
- Fetched from 3 endpoints (sideonline.json + admin APIs)
- Always showed staff members even when offline
- Gray dots for offline staff

**Current**:
- Single data source (sideonline.json only)
- Only shows online users (including staff when online)
- All green dots (simpler, cleaner)
